{
  "id": 315,
  "title": "趣闻 - 过去一周，程序员都在写什么语言？",
  "keywords": [
    "javascript",
    "node"
  ],
  "content": "\n一直以来我在使用一个叫**wakatime** 的工具来记录每天的编码情况。\n\n比如：\n\n![daily_waka.png](http://log.fyscu.com/usr/uploads/2018/03/637394479.png)\n\n想要了解**wakatime** 的， 自己去[https://wakatime.com](https://wakatime.com)了解一下。\n\n除了这个以外，**wakatime** 还提供一个公开的排行榜，展示了**最近七天** 用户的编码排名情况。\n\n![leader.png](http://log.fyscu.com/usr/uploads/2018/03/1817434637.png)\n\n### 于是机会来了。\n- 把这个排名的数据抓取下来，只要前40页\n- 把每一个用户使用的语言列表、每个语言的时长记录统计起来\n- 按语言归类， 看看哪个语言最近7天的使用时间最多。\n\n### 第一步，数据爬下来，目标40页\n我当然是不希望抓页面的，这样太没趣，更重要的是\n\n**人家有提供接口！！！** \n\n> \nhttps://wakatime.com/api/v1/leaders?page=1\n\n这下事情就简单多了，代码如下：\n\n```javascript\n'use strict';\nconst request = require('request-agent').init();\nconst fs = require('fs');\n\n(async () =&gt; {\n  let data = {};\n  for (let i = 0; i &lt; 40; i++) {\n    data = await request\n      .method('get')\n      .url(`https://wakatime.com/api/v1/leaders?page=${i + 1}`)\n      .send();\n    fs.writeFileSync(`./waka_stat/${i + 1}.json`, data.body);\n  }\n})().then((v) =&gt; {\n  console.log(v); process.exit(0);\n}).catch((e) =&gt; {\n  console.log(e);\n});\n```\n### 第二步，统计\n你可能要问， 为什么不一遍请求接口一遍统计呢？\n\n原因是这个接口速度有点蛋疼（翻墙好点）， 先把数据拉下来， 这样我统计的部分调试也方便。\n\n贴代码：\n\n```javascript\n'use strict';\nconst fs = require('fs');\nlet result = {};\n\nfor (let i = 1; i &lt;= 40; i++) {\n  let data = require(`./${i}.json`).data;\n  let len = data.length;\n  for (let k = 0; k &lt; len; k++) {\n    let languages = data[k].running_total.languages;\n    for (let index in languages) {\n      result[languages[index].name] = result[languages[index].name] || 0;\n      result[languages[index].name] += languages[index].total_seconds;\n    }\n  }\n}\n\nlet unsort = [];\nfor (let k in result) {\n  unsort.push({\n    name: k,\n    seconds: Number.parseInt(result[k] / 3600),\n  });\n}\nunsort.sort((a, b) =&gt; {\n  if (a.seconds &gt; b.seconds) return -1;\n  return 1;\n})\nfs.writeFileSync('./waka_stat/result.json', JSON.stringify(unsort, null, 2));\n```\n### 结果\n贴一部分：\n\n![WordArt.png](http://log.fyscu.com/usr/uploads/2018/03/748102548.png)\n\n```javascript\n[\n  {\n    \"name\": \"JavaScript\",\n    \"hours\": 15112\n  },\n  {\n    \"name\": \"PHP\",\n    \"hours\": 9366\n  },\n  {\n    \"name\": \"Java\",\n    \"hours\": 4164\n  },\n  {\n    \"name\": \"TypeScript\",\n    \"hours\": 3262\n  },\n  {\n    \"name\": \"Python\",\n    \"seconds\": 3119\n  },\n  {\n    \"name\": \"HTML\",\n    \"hours\": 3054\n  },\n  {\n    \"name\": \"C#\",\n    \"hours\": 2662\n  },\n  {\n    \"name\": \"Ruby\",\n    \"hours\": 1981\n  },\n  {\n    \"name\": \"Vue.js\",\n    \"hours\": 1698\n  }...\n```\n",
  "createdAt": 1520353646,
  "modified": 1520353646,
  "desc": "一直以来我在使用一个叫wakatime的工具来记录每天的编码情况。除了这个以外，wakatime还提供一个公开的排行榜，展示了最近七天用户的编码排名情况。"
}